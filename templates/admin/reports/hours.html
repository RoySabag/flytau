{% extends "admin/reports/report_layout.html" %}

{% set title = "Employee Flight Hours" %}
{% set date = "JAN 2026" %}

{% block report_content %}
<div class="mb-5 border-start border-4 border-info ps-4">
    <h5 class="text-uppercase text-info fw-bold small">Executive Summary</h5>
    <p class="text-muted">
        This chart shows the total flight hours for each crew member, divided by flight length.
        <strong>Short Flights (Orange, &lt;= 6h)</strong> represent standard routes, while
        <strong>Long Flights (Dark Blue, &gt; 6h)</strong> require longer rest periods for the crew.
        This data helps managers prevent fatigue and ensure the workload is balanced fairly among all employees.
    </p>
</div>

<div class="card bg-light border-0 p-4" style="border-radius: 12px;">
    <h6 class="text-center mb-4">Accumulated Flight Hours per Employee</h6>
    <div style="height: 500px;">
        <canvas id="hoursChart"></canvas>
    </div>
</div>

<!-- Metadata Footer -->
<div class="row mt-5">
    <div class="col-md-3">
        <small class="text-uppercase text-muted fw-bold" style="font-size: 0.75rem;">Status</small>
        <div class="d-flex align-items-center mt-1">
            <span class="badge bg-success rounded-circle p-1 me-2"> </span>
            <span class="fw-bold text-success">Finalized</span>
        </div>
    </div>
    <div class="col-md-3">
        <small class="text-uppercase text-muted fw-bold" style="font-size: 0.75rem;">Source</small>
        <div class="fw-bold text-dark mt-1 fst-italic">Live Database</div>
    </div>
    <div class="col-md-3">
        <small class="text-uppercase text-muted fw-bold" style="font-size: 0.75rem;">Generated By</small>
        <div class="fw-bold text-dark mt-1">FLYTAU Admin</div>
    </div>
    <div class="col-md-3">
        <small class="text-uppercase text-muted fw-bold" style="font-size: 0.75rem;">Format</small>
        <div class="fw-bold text-dark mt-1">High Fidelity</div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const rawData = {{ emp_hours | tojson
    }};

    const labels = rawData.map(x => x.label);
    const shortHours = rawData.map(x => x.short_flight_hours);
    const longHours = rawData.map(x => x.long_flight_hours);

    const ctx = document.getElementById('hoursChart').getContext('2d');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Short Flights (<=6h)',
                    data: shortHours,
                    backgroundColor: '#f59e0b', // Amber-500
                    borderRadius: 2,
                    stack: 'Stack 0'
                },
                {
                    label: 'Long Flights (>6h)',
                    data: longHours,
                    backgroundColor: '#1e293b', // Slate-800
                    borderRadius: 2,
                    stack: 'Stack 0'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    stacked: true,
                    ticks: {
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 45,
                        font: {
                            size: 11
                        }
                    }
                },
                y: {
                    stacked: true,
                    title: {
                        display: true,
                        text: 'Flight Hours'
                    },
                    beginAtZero: true
                }
            },
            plugins: {
                legend: { position: 'top', align: 'end' },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return context.dataset.label + ': ' + context.parsed.y + ' hrs';
                        }
                    }
                }
            }
        }
    });
        });
</script>
{% endblock %}